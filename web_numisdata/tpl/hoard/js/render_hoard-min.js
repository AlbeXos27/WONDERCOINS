"use strict";var render_hoard={caller:null,draw_hoard:async function(options){const row=options.row;if(console.log("draw_hoard options:",row),!row)return console.warn("Warning! draw_row row no found in options"),fragment;const coins=await this.cargarMonedasHallazgos(row.coins);console.log("MONEDAS ",coins);const fragment=new DocumentFragment,line=common.create_dom_element({element_type:"div",parent:fragment});if(!0===dedalo_logged){const link=common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",text_content:row.section_id,href:"/dedalo/lib/dedalo/main/?t=numisdata5&id="+row.section_id,parent:line});link.setAttribute("target","_blank")}if(console.log("ROW ",row),row.name&&row.name.length>0){const lineTittleWrap=common.create_dom_element({element_type:"div",class_name:"line-tittle-wrap",parent:line});if(common.create_dom_element({element_type:"div",class_name:"line-tittle golden-color",text_content:row.name,parent:lineTittleWrap}),row.place&&row.place.length>0){const place="| "+row.place;common.create_dom_element({element_type:"div",class_name:"info_value",text_content:place,parent:lineTittleWrap})}}if(row.coins&&row.coins.length>0){const n_coins=row.coins.length;common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:(tstring.total_coins||"Total coins")+": "+n_coins,parent:fragment})}if(row.public_info&&common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:row.public_info,parent:fragment}),row.bibliography_data&&row.bibliography_data.length>0){const lineSeparator=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:fragment});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:tstring.bibliographic_references||"Bibliographic references",parent:lineSeparator});const bibliography_block=common.create_dom_element({element_type:"div",class_name:"info_text_block",parent:fragment}),ref_biblio=row.bibliography_data,ref_biblio_length=ref_biblio.length;for(let i=0;i<ref_biblio_length;i++){const biblio_row_node=biblio_row_fields.render_row_bibliography(ref_biblio[i]),biblio_row_wrapper=common.create_dom_element({element_type:"div",class_name:"bibliographic_reference",parent:bibliography_block});biblio_row_wrapper.appendChild(biblio_row_node)}page.create_expandable_block(bibliography_block,fragment)}row.link&&common.create_dom_element({element_type:"a",class_name:"icon_link info_value",inner_html:row.link,href:row.link,target:"_blank",parent:fragment});const map_container=common.create_dom_element({element_type:"div",class_name:"map_container",parent:fragment}),map_fact=new map_factory;let resultado={hallazgos:{datos:[]},cecas:{datos:[]},complejos:{datos:[]}};const mints=await this.get_mint_points(row.types);resultado.cecas.datos=mints.result,resultado.hallazgos.datos.push(row);const map=map_fact.init({map_container:map_container,map_position:row.map,source_maps:page.maps_config.source_maps,result:resultado,findspot:!0,unique:!0}),title_coin=common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Monedas Encontradas",parent:fragment});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:title_coin});for(let index=0;index<coins.result.length;index++){const coinsContainer=common.create_dom_element({element_type:"div",class_name:"coins-container",parent:fragment}),title_container=common.create_dom_element({element_type:"div",class_name:"title-container",parent:coinsContainer}),typeValue=coins.result[index]&&coins.result[index].type_full_value?coins.result[index].type_full_value:"",parts=typeValue?typeValue.split("|"):[],lastPart=parts.length>0?parts[parts.length-1].trim():"",type_full_val=coins.result[index].denomination?coins.result[index].denomination+" | "+lastPart.replace(coins.result[index].denomination,"").trim():coins.result[index].type_full_value,type_none=type_full_val||"Tipo";let value,coin_type=coins.result[index].type_data?coins.result[index].type_data.replace('"',"").replace("[","").replace("]","").replace('"',""):0;common.create_dom_element({element_type:"a",class_name:"type_link",href:`/web_numisdata/type/${coin_type}`,text_content:type_none,parent:title_container});const data_container=common.create_dom_element({element_type:"div",class_name:"data-container",parent:coinsContainer}),imgContainer=common.create_dom_element({element_type:"div",class_name:"img-container",parent:data_container}),image_obverse="https://wondercoins.uca.es"+coins.result[index].image_obverse,image_reverse="https://wondercoins.uca.es"+coins.result[index].image_reverse;common.create_dom_element({element_type:"img",class_name:"img_obverse",parent:imgContainer,src:image_obverse}),common.create_dom_element({element_type:"img",class_name:"img_obverse",parent:imgContainer,src:image_reverse});const info_container=common.create_dom_element({element_type:"div",class_name:"info-container",parent:data_container}),dateInRaw=coins.result[index].date_in,dateOutRaw=coins.result[index].date_out,hasDateIn=!!dateInRaw,hasDateOut=!!dateOutRaw,dateIn=hasDateIn?dateInRaw.includes("-")?Math.abs(parseInt(dateInRaw))+" A.C.":dateInRaw+" D.C.":"N/A",dateOut=hasDateOut?dateOutRaw.includes("-")?Math.abs(parseInt(dateOutRaw))+" A.C.":dateOutRaw+" D.C.":"N/A",dateText=hasDateIn||hasDateOut?dateIn+" - "+dateOut:"N/A - N/A";common.create_dom_element({element_type:"p",class_name:"date_text",text_content:dateText,parent:info_container});const weightText=coins.result[index].weight?coins.result[index].weight+" gramos":"N/A";common.create_dom_element({element_type:"p",class_name:"weight_text",text_content:weightText,parent:info_container});const diameterText=coins.result[index].diameter?coins.result[index].diameter+" mm":"N/A";common.create_dom_element({element_type:"p",class_name:"diameter_text",text_content:diameterText,parent:info_container});const collectionText=coins.result[index].collection?coins.result[index].collection:"N/A";common.create_dom_element({element_type:"p",class_name:"collection_text",text_content:collectionText,parent:info_container});const findspot_container=common.create_dom_element({element_type:"div",class_name:"findspot_container",parent:coinsContainer});common.create_dom_element({element_type:"p",class_name:"findspot_text",text_content:coins.result[index].findspot.split(" | ")[0],parent:findspot_container})}return fragment},draw_types_list_node:function(options){const response=options.response,types_list_node=map.render_types_list({global_data_item:response.global_data_item,types_rows:response.types_rows,coins_rows:response.coins_rows,info:response.info});return types_list_node},cargarMonedasHallazgos:async function(ids){try{const filtro=Array.isArray(ids)?`section_id IN (${ids.join(",")})`:`section_id = ${ids}`,monedas=await data_manager.request({body:{dedalo_get:"records",table:"coins",ar_fields:["*"],sql_filter:filtro,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}});return monedas}catch(error){console.error("Error cargando datos:",error)}},get_mint_points:async function(types){let sql_filter="";for(let index=0;index<types.length;index++)sql_filter+=index!=types.length-1?`JSON_CONTAINS(relations_types, '"${types[index]}"') OR `:`JSON_CONTAINS(relations_types, '"${types[index]}"')`;try{const hijos=await data_manager.request({body:{dedalo_get:"records",table:"mints",ar_fields:["*"],sql_filter:sql_filter,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}});return hijos}catch(error){console.error("Error cargando datos:",error)}}};