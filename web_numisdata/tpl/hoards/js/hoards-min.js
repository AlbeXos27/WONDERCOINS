"use strict";var hoards={form:null,pagination:null,list:null,form_node:null,form_container:null,rows_container:null,table:null,button_atras:null,button_adelante:null,set_up:function(t){const e=this;e.form_container=t.form_container,e.rows_container=t.rows_container,e.table=t.table,e.form=new form_factory;const n=e.render_form();return e.form_container.appendChild(n),e.pagination={total:null,limit:15,offset:0,n_nodes:8},event_manager.subscribe("paginate",(function(t){e.pagination.offset=t,e.form_submit()})),e.form_submit(),!0},render_form:function(){const t=this,e=new DocumentFragment,n=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:e});t.form.item_factory({id:"global_search",name:"global_search",label:tstring.global_search||"global_search",q_column:"name",eq:"LIKE",eq_in:"%",eq_out:"%",class_name:"global_search",parent:n,callback:function(e){const n=e.node_input;let o=!1;n.addEventListener("input",(function(){n.value.trim().length>=3?(o||(t.form.activate_autocomplete({form_item:e,table:"findspots",parent_in:!0,global_search:!0}),o=!0),n.dispatchEvent(new Event("keyup"))):o&&($(n).autocomplete("destroy"),o=!1)}));let a;common.create_dom_element({element_type:"div",class_name:"search_operators_info",parent:n.parentNode}).addEventListener("click",(function(e){if(e.stopPropagation(),a)return a.remove(),void(a=null);a=t.form.full_text_search_operators_info(),n.parentNode.appendChild(a)})),window.addEventListener("click",(function(t){a&&!n.contains(t.target)&&(a.remove(),a=null)}))}}),t.form.item_factory({id:"name",name:"name",label:"Toponimia actual",q_column:"name",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){const n="findspots"===t.table?"findspots":"hoards";t.form.activate_autocomplete({form_item:e,table:n,parent_in:!0})}}),t.form.item_factory({id:"place",name:"place",label:"Toponomia histórica",q_column:"place",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){const n="findspots"===t.table?"findspots":"hoards";t.form.activate_autocomplete({form_item:e,table:n})}}),t.form.item_factory({id:"typology",name:"typology",label:tstring.typology||"Typology",q_column:"typology",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){const n=(t.table,"publications");t.form.activate_autocomplete({form_item:e,table:n})}}),t.form.item_factory({id:"indexation",name:"indexation",label:tstring.indexation||"Indexation",q_column:"indexation",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){const n="findspots"===t.table?"findspots":"hoards";t.form.activate_autocomplete({form_item:e,table:n})}});const o=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:e}),a=common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:o});common.create_dom_element({element_type:"div",class_name:"buttons_move",parent:e});return a.addEventListener("click",(function(e){e.preventDefault(),t.pagination={total:null,limit:15,offset:0,n_nodes:8},t.form_submit()})),t.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),t.form.node.appendChild(e),t.form.node},actualizarVista:async function(t,e,n){const o={lon:null,lat:null};n.contentDiv.innerHTML=`${e.result[t].name} | ${n.caminos_hallazgo[t]}`;const a=document.createElement("img");a.src=`https://wondercoins.uca.es${e.result[t].identify_image}`,a.alt="Imagen dinámica",n.img_ident.innerHTML="",n.img_ident.appendChild(a);const i=e.result[t].map;o.lat=i.lat,o.lon=i.lon,n.map_fact.move_map_to_point(o);const l=e.result[t];n.indexation.querySelector(".grid-stack-item-content").innerHTML=l.indexation;const s=l.bibliography_data.map((t=>`${t.ref_publications_title} / ${t.ref_publications_authors} / (${t.ref_publications_date})`));n.bibliography.querySelector(".grid-stack-item-content").innerHTML=`\n\t\t\t<div style="font-size: 1.3rem; text-align:center; position:absolute;top:0;width:100%;padding-right:10px;margin-top:10px;">\n\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\t\tmargin: 15px 0 15px; \n\t\t\t\t\t\t\t\tfont-size: 1.3rem;\n\t\t\t\t\t\t\t\theight: auto; \n\t\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\t\tBibliografía\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div style="text-align: left;">\n\t\t\t\t\t\t\t\t${s.join("<br>")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t`,n.public_info.querySelector(".grid-stack-item-content").innerHTML=`\n\t\t\t\t\n\t\t\t\t\t\t\t<div style="font-size: 1.3rem; text-align:center; position:absolute;top:0;width:100%;padding-right:20px;">\n\t\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\t\t\tmargin: 25px 0 10px; \n\t\t\t\t\t\t\t\t\tfont-size: 1.3rem;\n\t\t\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\t\t\tInformación pública\n\t\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t\t<div style="text-align: left; margin-top: 16px;">\n\t\t\t\t\t\t\t\t\t${e.result[t].public_info}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;const r=[],c=l.authorship_names?l.authorship_names.split("|").length:0;for(let t=0;t<c;t++){const e=l.authorship_names.split("|")[t]||"",n=l.authorship_surnames.split("|")[t]||"",o=l.authorship_roles&&l.authorship_roles.split("|")[t]||"No Definido";r.push(`${e} ${n} / ${o}`)}n.authors.querySelector(".grid-stack-item-content").innerHTML=`\n\t\t\t<div style="white-space: pre-line; font-size: 1.3rem; text-align:center; position:absolute; top:0;width:100%;padding-right:10px;">\n\t\t\t\t<h2 style="\n\t\t\t\tmargin: 0 0 10px; \n\t\t\t\tfont-size: 1.3rem; \n\t\t\t\tfont-weight: bold; \n\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\tdisplay: inline-block;\n\t\t\t\t">\n\t\t\t\tAutores\n\t\t\t\t</h2>\n\t\t\t\t<div style="text-align: left; margin-top: 6px;">\n\t\t\t\t${r.join("<br>")}\n\t\t\t\t</div>\n\t\t\t</div>`;const m=await this.cargarMonedasHallazgos(l.coins);let _='<div class="ceca-widget">';m.result.forEach((t=>{const e="https://wondercoins.uca.es"+t.image_obverse,n="https://wondercoins.uca.es"+t.image_reverse,o=t.type_full_value||"";_+=`\n\t\t\t\t<div class="coin-card">\n\t\t\t\t\t<div class="coin-imagenes">\n\t\t\t\t\t\t<img src="${e}" alt="anverso" class="coin-img">\n\t\t\t\t\t\t<img src="${n}" alt="reverso" class="coin-img">\n\t\t\t\t\t</div>\n\t\t\t\t\t<a class="coin-name" href="/web_numisdata/coin/${t.section_id}">${o}</a>\n\t\t\t\t</div>\n\t\t\t`})),_+="</div>",n.coins.querySelector(".grid-stack-item-content").innerHTML=_;let d="";const p=JSON.parse(l.parents_text);if(p)for(let t=0;t<p.length-1;t++)d+=p[t]+(t==p.length-2?"":" - ");n.road.innerHTML=d,n.arbol_completo.innerHTML="",n.arbol_completo.appendChild(await this.render_rows_hallazgo_completo(l))},actualizarVistaMobile:async function(t,e,n){const o={lon:null,lat:null},a=e.result[t];n.titulo_movil.innerHTML=`<a href="/web_numisdata/findspot/1186" class="title_mobile">${a.name} | ${n.caminos_hallazgo[t]}</a>`;const i=a.map;o.lat=i.lat,o.lon=i.lon,n.map_fact.move_map_to_point(o),n.info_mobile.innerHTML=a.public_info;let l=[];for(let t=0;t<a.bibliography_data.length;t++)l.push(a.bibliography_data[t].ref_publications_title+" / "+a.bibliography_data[t].ref_publications_authors+" / ("+a.bibliography_data[t].ref_publications_date+")");let s="";s=l.join("\n"),n.bibliografia_mobile.innerHTML=s;const r=[],c=a.authorship_names?a.authorship_names.split("|").length:0;for(let t=0;t<c;t++){const e=a.authorship_names.split("|")[t]||"",n=a.authorship_surnames.split("|")[t]||"",o=a.authorship_roles&&a.authorship_roles.split("|")[t]||"No Definido";r.push(`${e} ${n} / ${o}`)}n.autores_mobile.innerHTML=r.join("\n");let m="";const _=JSON.parse(a.parents_text);if(_)for(let t=0;t<_.length-1;t++)m+=_[t]+(t==_.length-2?"":" - ");n.road.innerHTML=m,n.arbol_completo.innerHTML="",n.arbol_completo.appendChild(await this.render_rows_hallazgo_completo(a))},form_submit:function(){const t=this;if(!t.form.node)return new Promise((function(t){t(!1)}));const e=t.rows_container;return t.pagination.total?e.classList.add("loading"):page.add_spinner(e),new Promise((function(n){const o="findspots"===t.table?"findspots":"hoards",a=t.form.build_filter(),i=t.form.parse_sql_filter(a,[],!0),l="(name != '' AND map != '')";let s=l;const r=i?"("+i+")":null;SHOW_DEBUG,r&&(s=l+" AND "+r),(""!==t.form.form_items.global_search.q||t.form.form_items.global_search.q_selected.length>0)&&(s+=" OR parents_text LIKE '%"+(""!==t.form.form_items.global_search.q?t.form.form_items.global_search.q:t.form.form_items.global_search.q_selected)+"%'");const c=document.getElementsByClassName("buttons_move");for(;c[0].hasChildNodes();)c[0].removeChild(c[0].lastChild);data_manager.request({body:{dedalo_get:"records",table:o,ar_fields:["*"],sql_filter:s,limit:0,count:!0,offset:0,order:"name",process_result:null,resolve_portals_custom:{bibliography_data:"bibliographic_references"}}}).then((async function(o){const a=page.parse_hoard_data(o.result),i=o.total,r=s==l?Math.floor(Math.random()*i):0;let m=" ",_=0;if(""!==t.form.form_items.global_search.q){t.button_atras=common.create_dom_element({element_type:"button",type:"button",id:"atras",value:tstring.search||"Search",parent:c[0]}),t.button_adelante=common.create_dom_element({element_type:"button",type:"button",id:"adelante",value:tstring.search||"Search",parent:c[0]}),a||(e.classList.remove("loading"),n(null));let l=[];for(let t=0;t<i;t++){const e=JSON.parse(o.result[t].parents_text);if(e){for(let t=0;t<e.length-1;t++)m+=e[t]+(t==e.length-2?"":" | ");l.push(m),m=" "}}!function(){for(;e.hasChildNodes();)e.removeChild(e.lastChild);e.classList.remove("loading")}();const s=common.create_dom_element({element_type:"div",class_name:"findspot_mobile",parent:e}),r=common.create_dom_element({element_type:"a",class_name:"title_mobile",text_content:`${o.result[_].name} | ${l[_]}`,href:`/web_numisdata/findspot/${o.result[_].section_id}`,parent:s}),d=common.create_dom_element({element_type:"div",class_name:"mapa_mobile",parent:s});let p={hallazgos:{datos:[]},cecas:{datos:[]},complejos:{datos:[]}};p.hallazgos.datos=o.result;const u=new map_factory,f=(u.init({map_container:d,map_position:o.result[_].map,source_maps:page.maps_config.source_maps,result:p,findspot:!0}),common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Información Pública",parent:s}));common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:f});const g=common.create_dom_element({element_type:"p",class_name:"info_mobile",parent:s});g.innerHTML=o.result[_].public_info;const h=common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Bibliografía",parent:s});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:h});let b=[];for(let t=0;t<o.result[_].bibliography_data.length;t++)b.push(o.result[_].bibliography_data[t].ref_publications_title+" / "+o.result[_].bibliography_data[t].ref_publications_authors+" / ("+o.result[_].bibliography_data[t].ref_publications_date+")");let y="";y=b.join("\n");const v=common.create_dom_element({element_type:"p",class_name:"bilbiografia_mobile",parent:s,text_content:y}),w=common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Autores",parent:s});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:w});let x=[];const $=o.result[_].authorship_names||"",z=o.result[_].authorship_roles||"",L=$.split("|"),q=z.split("|"),k=Math.max(L.length,q.length);for(let t=0;t<k;t++)x.push((L[t]||"")+"/"+(q[t]||""));let H=x.join("\n");const C=common.create_dom_element({element_type:"p",class_name:"autores_mobile",parent:s,text_content:H}),N=common.create_dom_element({element_type:"div",class_name:"container_title_mobile",parent:e}),T=(common.create_dom_element({element_type:"h1",class_name:"title",text_content:"Hallazgo Jerarquizado",parent:N}),common.create_dom_element({element_type:"img",class_name:"imagen",src:"tpl/assets/images/arrow-right.svg",parent:N}));let M="";const S=JSON.parse(o.result[_].parents_text);if(S)for(let t=0;t<S.length-1;t++)M+=S[t]+(t==S.length-2?"":" - ");const E=common.create_dom_element({element_type:"div",class_name:"line-tittle_mid",text_content:M,parent:e});E.style.display="none";let j=!1;T.addEventListener("mousedown",(function(){j?(T.style.transform="rotate(0deg) translateY(0.75vh)",E.style.display="none"):(T.style.transform="rotate(90deg) translateX(0.75vh)",E.style.display="block"),j=!j}));const W=common.create_dom_element({element_type:"div",class_name:"arbol_moneda_mobile",parent:e});W.appendChild(await t.render_rows_hallazgo_completo(o.result[_]));const A={titulo_movil:r,map_fact:u,info_mobile:g,bibliografia_mobile:v,autores_mobile:C,caminos_hallazgo:l,arbol_completo:W,road:E};if(t.button_atras.addEventListener("click",(async function(e){_>0&&(_--,await t.actualizarVistaMobile(_,o,A))})),t.button_adelante.addEventListener("click",(async function(e){_<i-2&&(_++,await t.actualizarVistaMobile(_,o,A))})),window.innerWidth>768){const n=common.create_dom_element({element_type:"div",class_name:"grid-stack",parent:e}),a=GridStack.init(n),s=a.addWidget({w:12,h:2,content:`${o.result[_].name} | ${l[_]}`}).querySelector(".grid-stack-item-content");s.id="titulo-ficha";const r=new map_factory,c=a.addWidget({w:4,h:4,content:`<img src="https://wondercoins.uca.es${o.result[_].identify_image}" alt="Imagen dinámica" style="width:100%; height:100%; object-fit:cover; overflow: hidden;"`}).querySelector(".grid-stack-item-content");c.id="img_ident";const m=a.addWidget({w:4,h:4,content:""});let d={hallazgos:{datos:[]},cecas:{datos:[]},complejos:{datos:[]}};d.hallazgos.datos=o.result,r.init({map_container:m,map_position:o.result[_].map,source_maps:page.maps_config.source_maps,result:d,findspot:!0});const p=await t.cargarMonedasHallazgos(o.result[_].coins);let u='<div class="ceca-widget">';p.result.forEach((t=>{const e="https://wondercoins.uca.es"+t.image_obverse,n="https://wondercoins.uca.es"+t.image_reverse,o=t.type_full_value||"";u+=`\n\t\t\t\t\t\t\t\t<div class="coin-card">\n\t\t\t\t\t\t\t\t\t<div class = "coin-imagenes">\n\t\t\t\t\t\t\t\t\t<img src="${e}" alt="anverso" class="coin-img">\n\t\t\t\t\t\t\t\t\t<img src="${n}" alt="reverso" class="coin-img"> </div>\n\t\t\t\t\t\t\t\t\t<a class="coin-name" href="/web_numisdata/coin/${t.section_id}">${o}</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`})),u+="</div>";const f=a.addWidget({w:4,h:10,content:u}),g=JSON.parse(o.result[_].indexation_data);let h="";if(g)for(let t=0;t<g.length;t++)h+=t<g.length-1?"section_id = "+g[t]+" OR ":"section_id = "+g[t];const b=await t.cargarCategorizacionHallazgo(h);let y=[];for(let t=0;t<b.result.length;t++)y.push(b.result[t].term);a.addWidget({w:8,h:1,content:y.join(" - ")});const v=[];for(let t=0;t<b.result.length;t++)v.push(b.result[t].section_id);const w=await t.cargarFuncionalidadHallazgo(h);w.result=w.result.filter((t=>!v.includes(t.section_id)));let x=[];for(let t=0;t<w.result.length;t++){const e=w.result[t].term,n=e?e.includes("|")?e.split("|")[0].trim():e.trim():"";x.push(n)}a.addWidget({w:8,h:1,content:x.join(" - ")});const $=o.result[_].period;a.addWidget({w:8,h:1,content:$});let z=[];for(let t=0;t<o.result[_].bibliography_data.length;t++)z.push(o.result[_].bibliography_data[t].ref_publications_title+" / "+o.result[_].bibliography_data[t].ref_publications_authors+" / ("+o.result[_].bibliography_data[t].ref_publications_date+")");let L="";L=z.join("\n");const q=a.addWidget({w:8,h:3,content:`<div style="font-size: 1.3rem; text-align:center; position:absolute;top:0;width:100%;padding-right:10px;margin-top:10px;">\n\t\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\t\t\tmargin: 15px 0 15px; \n\t\t\t\t\t\t\t\t\tfont-size: 1.3rem;\n\t\t\t\t\t\t\t\t\theight: auto; \n\t\t\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\t\t\tBibliografía\n\t\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div style="text-align: left;">\n\t\t\t\t\t\t\t\t${z.join("<br>")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`}),k=a.addWidget({w:8,h:4,content:`\n\t\t\t\t\t\t\t\t<div style="font-size: 1.3rem; text-align:center; position:absolute;top:0;width:100%;padding-right:20px;">\n\t\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\t\t\tmargin: 25px 0 10px; \n\t\t\t\t\t\t\t\t\tfont-size: 1.3rem;\n\t\t\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\t\t\tInformación pública\n\t\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t\t<div style="text-align: left; margin-top: 16px;">\n\t\t\t\t\t\t\t\t\t${o.result[_].public_info}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`});let H=[];const C=o.result[_].authorship_names;let N=C?C.split("|").length:0;for(let t=0;t<N;t++){const e=o.result[_],n=e.authorship_names?e.authorship_names.split("|")[t]:"",a=e.authorship_surnames?e.authorship_surnames.split("|")[t]:"",i=e.authorship_roles&&e.authorship_roles.split("|")[t]?e.authorship_roles.split("|")[t]:"No Definido";H.push(`${n} ${a} / ${i}`)}let T="";T=H.join("\n");const M=a.addWidget({w:4,h:4,content:`<div style=" font-size: 1.3rem; text-align:center; position:absolute; top:0;width:100%;padding-right:7px;">\n\n\t\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\t\tmargin: 20 0 2 0px; \n\t\t\t\t\t\t\t\tfont-size: 1.3rem; \n\t\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\t\tAutores\n\t\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t\t<div style="text-align: left; margin-top: 6px;">\n\t\t\t\t\t\t\t\t${H.join("<br>")}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`}),S=common.create_dom_element({element_type:"div",class_name:"container_title",parent:e}),E=(common.create_dom_element({element_type:"h1",class_name:"title",text_content:"Hallazgo Jerarquizado",parent:S}),common.create_dom_element({element_type:"img",class_name:"imagen",src:"tpl/assets/images/arrow-right.svg",parent:S}));common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:e});let j="";const W=JSON.parse(o.result[_].parents_text);if(W)for(let t=0;t<W.length-1;t++)j+=W[t]+(t==W.length-2?"":" - ");const A=common.create_dom_element({element_type:"div",class_name:"line-tittle_mid",text_content:j,parent:e});A.style.display="none";let I=!1;E.addEventListener("mousedown",(function(){I?(E.style.transform="rotate(0deg) translateY(0.75vh)",A.style.display="none"):(E.style.transform="rotate(90deg) translateX(0.75vh)",A.style.display="block"),I=!I}));const D=common.create_dom_element({element_type:"div",class_name:"arbol_moneda",parent:e});D.appendChild(await t.render_rows_hallazgo_completo(o.result[_]));const O={contentDiv:s,img_ident:c,indexation:indexation,public_info:k,bibliography:q,authors:M,coins:f,road:A,arbol_completo:D,caminos_hallazgo:l,map_fact:r};t.button_atras.addEventListener("click",(async function(e){_>0&&(_--,await t.actualizarVista(_,o,O))})),t.button_adelante.addEventListener("click",(async function(e){_<i-2&&(_++,await t.actualizarVista(_,o,O))}))}}else{let i=" ";a||(e.classList.remove("loading"),n(null)),function(){for(;e.hasChildNodes();)e.removeChild(e.lastChild);e.classList.remove("loading")}();const l=common.create_dom_element({element_type:"div",class_name:"findspot_mobile",parent:e}),s=JSON.parse(o.result[r].parents_text);if(s)for(let t=0;t<s.length-1;t++)i+=s[t]+(t==s.length-2?"":" | ");common.create_dom_element({element_type:"a",class_name:"title_mobile",text_content:`${o.result[r].name} | ${i}`,href:`/web_numisdata/findspot/${o.result[r].section_id}`,parent:l});const c=common.create_dom_element({element_type:"div",class_name:"mapa_mobile",parent:l});let m={hallazgos:{datos:[]},cecas:{datos:[]},complejos:{datos:[]}};m.hallazgos.datos.push(o.result[r]);(new map_factory).init({map_container:c,map_position:o.result[r].map,source_maps:page.maps_config.source_maps,result:m,findspot:!0});const d=common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Información Pública",parent:l});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:d});common.create_dom_element({element_type:"p",class_name:"info_mobile",parent:l}).innerHTML=o.result[r].public_info;const p=common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Bibliografía",parent:l});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:p});let u=[];for(let t=0;t<o.result[r].bibliography_data.length;t++)u.push(o.result[r].bibliography_data[t].ref_publications_title+" / "+o.result[r].bibliography_data[t].ref_publications_authors+" / ("+o.result[r].bibliography_data[t].ref_publications_date+")");let f="";f=u.join("\n");common.create_dom_element({element_type:"p",class_name:"bilbiografia_mobile",parent:l,text_content:f});const g=common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Autores",parent:l});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:g});let h=[];const b=o.result[_].authorship_names||"",y=o.result[_].authorship_roles||"",v=b.split("|"),w=y.split("|"),x=Math.max(v.length,w.length);for(let t=0;t<x;t++)h.push((v[t]||"")+"/"+(w[t]||""));let $=h.join("\n");common.create_dom_element({element_type:"p",class_name:"autores_mobile",parent:l,text_content:$});if(window.innerWidth>768){const n=common.create_dom_element({element_type:"div",class_name:"grid-stack",parent:e}),a=await t.cargarMonedasHallazgos(o.result[r].coins),l=GridStack.init(n);l.addWidget({w:12,h:2,content:`${o.result[r].name} | ${i}`}).querySelector(".grid-stack-item-content").id="titulo-ficha";const s=new map_factory;l.addWidget({w:4,h:4,content:`<img src="https://wondercoins.uca.es${o.result[r].identify_image}" alt="Imagen dinámica" style="width:100%; height:100%; object-fit:cover; overflow: hidden;"`}).querySelector(".grid-stack-item-content").id="img_ident";const c=l.addWidget({w:4,h:4,content:""});let m={hallazgos:{datos:[]},cecas:{datos:[]},complejos:{datos:[]}};m.hallazgos.datos.push(o.result[r]),s.init({map_container:c,map_position:o.result[r].map,source_maps:page.maps_config.source_maps,result:m,findspot:!0});let d='<div class="ceca-widget">';a.result.forEach((t=>{const e="https://wondercoins.uca.es"+t.image_obverse,n="https://wondercoins.uca.es"+t.image_reverse,o=t.type_full_value||"";d+=`\n\t\t\t\t\t\t\t\t<div class="coin-card">\n\t\t\t\t\t\t\t\t\t<div class = "coin-imagenes">\n\t\t\t\t\t\t\t\t\t<img src="${e}" alt="anverso" class="coin-img">\n\t\t\t\t\t\t\t\t\t<img src="${n}" alt="reverso" class="coin-img"> </div>\n\t\t\t\t\t\t\t\t\t<a class="coin-name" href="/web_numisdata/coin/${t.section_id}">${o}</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`})),d+="</div>";l.addWidget({w:4,h:10,content:d});const p=JSON.parse(o.result[r].indexation_data);let u="";if(p)for(let t=0;t<p.length;t++)u+=t<p.length-1?"section_id = "+p[t]+" OR ":"section_id = "+p[t];const f=await t.cargarCategorizacionHallazgo(u);let g=[];for(let t=0;t<f.result.length;t++)g.push(f.result[t].term);l.addWidget({w:8,h:1,content:g.join(" - ")});const h=[];for(let t=0;t<f.result.length;t++)h.push(f.result[t].section_id);const b=await t.cargarFuncionalidadHallazgo(u);b.result=b.result.filter((t=>!h.includes(t.section_id)));let y=[];for(let t=0;t<b.result.length;t++){const e=b.result[t].term,n=e?e.includes("|")?e.split("|")[0].trim():e.trim():"";y.push(n)}l.addWidget({w:8,h:1,content:y.join(" - ")});const v=o.result[_].period;l.addWidget({w:8,h:1,content:v});let w=[];for(let t=0;t<o.result[r].bibliography_data.length;t++)w.push(o.result[r].bibliography_data[t].ref_publications_title+" / "+o.result[r].bibliography_data[t].ref_publications_authors+" / ("+o.result[r].bibliography_data[t].ref_publications_date+")");let x="";x=w.join("\n"),l.addWidget({w:8,h:3,content:`<div style="font-size: 1.3rem; text-align:center; position:absolute;top:0;width:100%;padding-right:10px;margin-top:10px;">\n\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\tmargin: 15px 0 15px; \n\t\t\t\t\t\t\tfont-size: 1.3rem;\n\t\t\t\t\t\t\theight: auto; \n\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\tBibliografía\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div style="text-align: left;">\n\t\t\t\t\t\t\t${w.join("<br>")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`}),l.addWidget({w:8,h:4,content:`\n\t\t\t\t\t\t\t\t<div style="font-size: 1.3rem; text-align:center; position:absolute;top:0;width:100%;padding-right:20px;">\n\t\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\t\t\tmargin: 25px 0 10px; \n\t\t\t\t\t\t\t\t\tfont-size: 1.3rem;\n\t\t\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\t\t\tInformación pública\n\t\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t\t<div style="text-align: left; margin-top: 16px;">\n\t\t\t\t\t\t\t\t\t${o.result[r].public_info}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`});let $=[];const z=o.result[r].authorship_names||"",L=o.result[r].authorship_roles||"",q=z.split("|"),k=L.split("|"),H=Math.max(q.length,k.length);for(let t=0;t<H;t++)$.push((q[t]||"")+"/"+(k[t]||""));l.addWidget({w:4,h:4,content:`<div style="font-size: 1.3rem; text-align:center; position:absolute; top:0;width:100%;">\n\t\t\t\t\t\t\t<h2 style="\n\t\t\t\t\t\t\tmargin: 20px 0 15px; \n\t\t\t\t\t\t\tfont-size: 1.3rem; \n\t\t\t\t\t\t\tfont-weight: bold; \n\t\t\t\t\t\t\tborder-bottom: 3px solid transparent;\n\t\t\t\t\t\t\tborder-image: linear-gradient(to right, #d4af37, #ffd700, #d4af37) 1;\n\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t">\n\t\t\t\t\t\t\tAutores\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t\t<div style="text-align: left; margin-top: 6px;">\n\t\t\t\t\t\t\t${$.join("<br>")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`})}const z=common.create_dom_element({element_type:"div",class_name:"container_title",parent:e}),L=(common.create_dom_element({element_type:"h1",class_name:"title",text_content:"Hallazgo Jerarquizado",parent:z}),common.create_dom_element({element_type:"img",class_name:"imagen",src:"tpl/assets/images/arrow-right.svg",parent:z}));common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:e});let q="";const k=JSON.parse(o.result[r].parents_text);if(k)for(let t=0;t<k.length-1;t++)q+=k[t]+(t==k.length-2?"":" - ");const H=common.create_dom_element({element_type:"div",class_name:"line-tittle_mid",text_content:q,parent:e});H.style.display="none";let C=!1;L.addEventListener("mousedown",(function(){C?(L.style.transform="rotate(0deg) translateY(0.75vh)",H.style.display="none"):(L.style.transform="rotate(90deg) translateX(0.75vh)",H.style.display="block"),C=!C}));common.create_dom_element({element_type:"div",class_name:"arbol_moneda",parent:e}).appendChild(await t.render_rows_hallazgo_completo(o.result[r]))}}));const m=document.querySelector(".rows_container");m&&m.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}))},render_rows_hallazgo:async function(t){const e=new DocumentFragment;var n=await this.createfindspot_Tree(t);return this.generate_Tree(n,n[0],e,0),e},render_rows_hallazgo_completo:async function(t){const e=new DocumentFragment;var n=await this.createfindspot_Tree(t);return this.generate_Tree_completo(n,n[0],e,0,0,2),e},createfindspot_Tree:async function(t){const e=[],n=await this.cargarHijosHallazgos(t.section_id);e.push({info_nodo:t,padre:null});for(let t=0;t<n.result.length;t++){const o=JSON.parse(n.result[t].parents);e.push({info_nodo:n.result[t],padre:o[0]})}return e},cargarCategorizacionHallazgo:async function(t){try{return await data_manager.request({body:{dedalo_get:"records",table:"ts_find_category",ar_fields:["*"],sql_filter:t,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}})}catch(t){}},cargarFuncionalidadHallazgo:async function(t){try{return await data_manager.request({body:{dedalo_get:"records",table:"ts_find_context",ar_fields:["*"],sql_filter:t,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}})}catch(t){}},cargarHijosHallazgos:async function(t){try{return await data_manager.request({body:{dedalo_get:"records",table:"findspots",ar_fields:["*"],sql_filter:`parents LIKE '%"${t}"%'`,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}})}catch(t){}},generate_Tree:function(t,e,n,o){const a=common.create_dom_element({element_type:"div",class_name:"container_prueba",text_content:e.info_nodo.name,parent:n});if(a.style.paddingLeft=`${o}em`,null!=e.info_nodo.children)for(let n=0;n<t.length;n++)t[n].info_nodo.parent=='["'+e.info_nodo.section_id+'"]'&&(t[n].padre="'"+e.info_nodo.section_id+"'",this.generate_Tree(t,t[n],a,1.5))},cargarMonedasHallazgos:async function(t){try{const e=Array.isArray(t)?`section_id IN (${t.join(",")})`:`section_id = ${t}`;return await data_manager.request({body:{dedalo_get:"records",table:"coins",ar_fields:["*"],sql_filter:e,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}})}catch(t){}},generate_Tree_completo:async function(t,e,n,o,a,i){const l=common.create_dom_element({element_type:"div",class_name:"container_prueba",parent:n}),s=common.create_dom_element({element_type:"a",class_name:"info_link",text_content:e.info_nodo.name,href:`/web_numisdata/findspot/${e.info_nodo.section_id}`,parent:l});if(l.style.paddingLeft=`${o}em`,s.style.fontSize=`${i}rem`,s.style.textTransform="uppercase",s.style.fontWeight="bold",null!=e.info_nodo.coins){const t=await this.cargarMonedasHallazgos(e.info_nodo.coins),n=common.create_dom_element({element_type:"button",class_name:"button_display",parent:l});n.textContent="Ver monedas",n.classList.add(`button_display_${e.info_nodo.section_id}`);const o=common.create_dom_element({element_type:"div",class_name:`swiper swiper_${e.info_nodo.section_id}`,parent:l});o.style.display="none";const a=common.create_dom_element({element_type:"div",class_name:"swiper-wrapper",parent:o});for(let e=0;e<t.result.length;e++){const n=common.create_dom_element({element_type:"div",class_name:"swiper-slide",parent:a}),o=common.create_dom_element({element_type:"div",class_name:"flip-card",parent:n});o.classList.add(`flip-card_${t.result[e].section_id}`),o.style.fontWeight="normal";const i=common.create_dom_element({element_type:"div",class_name:"flip-card-inner",parent:o}),l=common.create_dom_element({element_type:"div",class_name:"flip-card-front",parent:i}),s="https://wondercoins.uca.es"+t.result[e].image_obverse,r="https://wondercoins.uca.es"+t.result[e].image_reverse;common.create_dom_element({element_type:"img",class_name:"img_obverse",parent:l,src:s}),common.create_dom_element({element_type:"img",parent:l,src:r});const c=common.create_dom_element({element_type:"div",class_name:"flip-card-back",parent:i});let m=t.result[e].type_data?t.result[e].type_data.replace('"',"").replace("[","").replace("]","").replace('"',""):0;const _=common.create_dom_element({element_type:"div",class_name:"type_container",parent:c}),d=t.result[e].denomination?t.result[e].denomination+t.result[e].type_full_value.split(`${t.result[e].denomination}`)[1]:t.result[e].type_full_value,p=d||"Tipo";common.create_dom_element({element_type:"a",class_name:"type_link",href:`/web_numisdata/type/${m}`,text_content:p,parent:_});const u=common.create_dom_element({element_type:"div",class_name:"findspot_container",parent:c});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Lugar de Hallazgo:",parent:u});let f=(t.result[e].findspot||"").split(" | ")[0].trim();"Lugar del hallazgo"===f.toLowerCase()&&(f=""),common.create_dom_element({element_type:"p",class_name:"findspot_text",text_content:f,parent:u});const g=common.create_dom_element({element_type:"div",class_name:"date_container",parent:c});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Datación de la moneda: ",parent:g});const h=t.result[e].date_in,b=t.result[e].date_out,y=!!h,v=!!b,w=y?h.includes("-")?Math.abs(parseInt(h))+" A.C.":h+" D.C.":"N/A",x=v?b.includes("-")?Math.abs(parseInt(b))+" A.C.":b+" D.C.":"N/A",$=y||v?w+" - "+x:"N/A - N/A";common.create_dom_element({element_type:"p",class_name:"date_text",text_content:$,parent:g});const z=common.create_dom_element({element_type:"div",class_name:"weigdia_container",parent:c}),L=common.create_dom_element({element_type:"div",class_name:"weight_container",parent:z});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Peso: ",parent:L});const q=t.result[e].weight?t.result[e].weight+" gramos":"N/A";common.create_dom_element({element_type:"p",class_name:"weight_text",text_content:q,parent:L});const k=common.create_dom_element({element_type:"div",class_name:"diameter_container",parent:z});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Diametro: ",parent:k});const H=t.result[e].diameter?t.result[e].diameter+" mm":"N/A";common.create_dom_element({element_type:"p",class_name:"diameter_text",text_content:H,parent:k});const C=common.create_dom_element({element_type:"div",class_name:"dico_container",parent:c}),N=common.create_dom_element({element_type:"div",class_name:"dies_container",parent:C});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Posición de cuños: ",parent:N});const T=t.result[e].dies?t.result[e].dies:"N/A";common.create_dom_element({element_type:"p",class_name:"dies_text",text_content:T,parent:N});const M=common.create_dom_element({element_type:"div",class_name:"collection_container",parent:C});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Colección: ",parent:M});const S=t.result[e].collection?t.result[e].collection:"N/A";common.create_dom_element({element_type:"p",class_name:"collection_text",text_content:S,parent:M});const E=common.create_dom_element({element_type:"div",class_name:"finsec_container",parent:c}),j=common.create_dom_element({element_type:"div",class_name:"fin_type_container",parent:E});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Tipo de hallazgo: ",parent:j});const W=t.result[e].find_type?t.result[e].find_type:"N/A";common.create_dom_element({element_type:"p",class_name:"fin_type_text",text_content:W,parent:j});const A=common.create_dom_element({element_type:"div",class_name:"section_id_container",parent:E});common.create_dom_element({element_type:"p",class_name:"descriptive_title",text_content:"Nº de inventario: ",parent:A});const I=t.result[e].section_id?t.result[e].section_id:"N/A";common.create_dom_element({element_type:"p",class_name:"section_id_text",text_content:I,parent:A}),document.addEventListener("click",(n=>{const o=n.target.closest(`.flip-card_${t.result[e].section_id}`);o&&o.classList.toggle("flipped")}))}common.create_dom_element({element_type:"div",class_name:`swiper-button-prev swiper-prev-${e.info_nodo.section_id}`,parent:o}),common.create_dom_element({element_type:"div",class_name:`swiper-button-next swiper-next-${e.info_nodo.section_id}`,parent:o}),common.create_dom_element({element_type:"div",class_name:`swiper-pagination swiper-pagination-${e.info_nodo.section_id}`,parent:o}),o.style.paddingLeft="1em",new Swiper(`.swiper_${e.info_nodo.section_id}`,{pagination:{el:`.swiper-pagination-${e.info_nodo.section_id}`,clickable:!0},navigation:{nextEl:`.swiper-next-${e.info_nodo.section_id}`,prevEl:`.swiper-prev-${e.info_nodo.section_id}`}});let i=!1;document.addEventListener("mousedown",(t=>{t.target.closest(`.button_display_${e.info_nodo.section_id}`)&&o&&(i?(n.textContent="Ver monedas",o.style.display="none"):(n.textContent="Ocultar monedas",o.style.display="block"),i=!i)}))}if(null!=e.info_nodo.children)for(let n=0;n<t.length;n++)t[n].info_nodo.parent=='["'+e.info_nodo.section_id+'"]'&&(t[n].padre="'"+e.info_nodo.section_id+"'",window.innerWidth>768?this.generate_Tree_completo(t,t[n],l,2,a+1,i-.1):this.generate_Tree_completo(t,t[n],l,.4,a+1,i-.2))}};