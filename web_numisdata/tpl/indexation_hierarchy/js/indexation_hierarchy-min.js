"use strict";var indexation_hierarchy={rows_container:null,tree_container:null,list:null,pagination:null,current_node_id:null,set_up:async function(options){const self=this;this.rows_container=options.rows_container,this.tree_container=options.tree_container,this.pagination={total:null,limit:10,offset:0,n_nodes:8};const arbol_completo=common.create_dom_element({element_type:"div",class_name:"arbol_completo",parent:this.tree_container});await this.generate_data(1,arbol_completo,0,0,"ts_find_category"),await this.generate_data(134,arbol_completo,0,0,"ts_find_context")},generate_data:async function(id,nodo_padre,tab,nivel,table){const self=this,datos=await self.get_data(table,id,0===nivel);if(datos&&datos.result)for(let i=0;i<datos.result.length;i++){const node_data=datos.result[i],nodo=common.create_dom_element({element_type:"div",class_name:"container_indexation",parent:nodo_padre});nodo.classList.add(table),nodo.style.paddingLeft=`${tab}em`,nodo.textContent=node_data.term;let estado_mostrar=!1,hijos_creados=!1;if(node_data.children||0===nivel){const button=common.create_dom_element({element_type:"img",class_name:"button_display",src:"tpl/assets/images/arrow-right.svg",parent:nodo});button.classList.add(`button_display_${node_data.section_id}_${table}`),button.addEventListener("click",(function(e){e.stopPropagation();const hijos_ocultables=Array.from(nodo.children).filter(hijo=>hijo.classList.contains("container_indexation"));estado_mostrar?(button.style.transform="rotate(0deg) translateX(20%) translateY(25%)",hijos_ocultables.forEach(h=>h.style.display="none")):(button.style.transform="rotate(90deg) translateX(20%) translateY(-25%)",hijos_ocultables.forEach(h=>h.style.display="block"),hijos_creados||(self.generate_data(node_data.section_id,nodo,tab+1.5,nivel+1,table),hijos_creados=!0)),estado_mostrar=!estado_mostrar}))}nodo.addEventListener("click",(async function(e){e.stopPropagation(),self.current_node_id=node_data.section_id,self.pagination.offset=0,0!=nivel&&await self.reload_current_node(),self._paginate_event_subscribed||(self._paginate_event_subscribed=!0,event_manager.subscribe("paginate",(async function(offset){self.pagination.offset=offset,await self.reload_current_node()})));const div_result=document.querySelector("#rows_container");div_result&&div_result.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}))}},reload_current_node:async function(){const self=this;if(!self.current_node_id)return;const filas=await self.get_rows_container(self.current_node_id);if(!filas||!filas.result)return;const data=page.parse_hoard_data(filas.result);for(self.pagination.total=filas.total;self.rows_container.firstChild;)self.rows_container.removeChild(self.rows_container.firstChild);self.list=new list_factory,self.list.init({data:data,fn_row_builder:function(d){return indexation_hierarchy.generate_row(d,self.rows_container)},pagination:self.pagination,caller:self}),self.list.render_list().then((function(list_node){list_node&&self.rows_container.appendChild(list_node)}))},get_data:async function(table,id,parent){const sql_filter=parent?`section_id = ${id}`:`parent LIKE "%${"ts_find_category"===table?"tchicategory":"cont"}1_${id}%"`;try{return await data_manager.request({body:{dedalo_get:"records",table:table,ar_fields:["*"],sql_filter:sql_filter,limit:0,count:!0,offset:0,order:"norder",process_result:null}})}catch(err){return console.error("Error fetching data:",err),null}},get_rows_container:async function(id){const self=this;try{return await data_manager.request({body:{dedalo_get:"records",table:"findspots",ar_fields:["*"],sql_filter:`JSON_CONTAINS(indexation_data,'"${id}" ') AND typology != ""`,limit:self.pagination.limit,count:!0,offset:self.pagination.offset,order:"section_id",process_result:null}})}catch(err){return console.error("Error fetching rows:",err),null}},generate_row:function(data,parent){const container=common.create_dom_element({element_type:"div",class_name:"container_row_indexation_findspots",parent:parent});return common.create_dom_element({element_type:"a",class_name:"row_indexation_findspots",href:`findspot/${data.section_id}`,text_content:data.name,parent:container}),container}};