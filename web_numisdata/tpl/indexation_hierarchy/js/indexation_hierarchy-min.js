"use strict";var indexation_hierarchy={rows_container:null,tree_container:null,list:null,pagination:null,current_node_id:null,set_up:async function(t){const e=this;e.rows_container=t.rows_container,e.tree_container=t.tree_container,e.pagination={total:null,limit:10,offset:0,n_nodes:8};const n=common.create_dom_element({element_type:"div",class_name:"arbol_completo",parent:e.tree_container});await e.generate_data(1,n,0,0,"ts_find_category"),await e.generate_data(134,n,0,0,"ts_find_context")},generate_data:async function(t,e,n,a,o){const r=this,i=await r.get_data(o,t,0===a);if(i&&i.result)for(let t=0;t<i.result.length;t++){const s=i.result[t],c=common.create_dom_element({element_type:"div",class_name:"container_indexation",parent:e});c.classList.add(o),c.style.paddingLeft=`${n}em`,c.textContent=s.term;let _=!1,l=!1;if(s.children||0===a){const t=common.create_dom_element({element_type:"img",class_name:"button_display",src:"tpl/assets/images/arrow-right.svg",parent:c});t.classList.add(`button_display_${s.section_id}_${o}`),t.addEventListener("click",(function(e){e.stopPropagation();const i=Array.from(c.children).filter((t=>t.classList.contains("container_indexation")));_?(t.style.transform="rotate(0deg)",i.forEach((t=>t.style.display="none"))):(t.style.transform="rotate(90deg)",i.forEach((t=>t.style.display="block")),l||(r.generate_data(s.section_id,c,n+1.5,a+1,o),l=!0)),_=!_}))}c.addEventListener("click",(async function(t){t.stopPropagation(),r.current_node_id=s.section_id,r.pagination.offset=0,0!=a&&await r.reload_current_node(),r._paginate_event_subscribed||(r._paginate_event_subscribed=!0,event_manager.subscribe("paginate",(async function(t){r.pagination.offset=t,await r.reload_current_node()})));const e=document.querySelector("#rows_container");e&&e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}))}},reload_current_node:async function(){const t=this;if(!t.current_node_id)return;const e=await t.get_rows_container(t.current_node_id);if(!e||!e.result)return;const n=page.parse_hoard_data(e.result);for(t.pagination.total=e.total;t.rows_container.firstChild;)t.rows_container.removeChild(t.rows_container.firstChild);t.list=new list_factory,t.list.init({data:n,fn_row_builder:function(e){return indexation_hierarchy.generate_row(e,t.rows_container)},pagination:t.pagination,caller:t}),t.list.render_list().then((function(e){e&&t.rows_container.appendChild(e)}))},get_data:async function(t,e,n){const a=n?`section_id = ${e}`:`parent LIKE "%${"ts_find_category"===t?"tchicategory":"cont"}1_${e}%"`;try{return await data_manager.request({body:{dedalo_get:"records",table:t,ar_fields:["*"],sql_filter:a,limit:0,count:!0,offset:0,order:"norder",process_result:null}})}catch(t){return null}},get_rows_container:async function(t){const e=this;try{return await data_manager.request({body:{dedalo_get:"records",table:"findspots",ar_fields:["*"],sql_filter:`JSON_CONTAINS(indexation_data,'"${t}"') AND typology != ""`,limit:e.pagination.limit,count:!0,offset:e.pagination.offset,order:"section_id",process_result:null}})}catch(t){return null}},generate_row:function(t,e){const n=common.create_dom_element({element_type:"div",class_name:"container_row_indexation_findspots",parent:e}),a=JSON.parse(t.parents_text).join(" | ");return common.create_dom_element({element_type:"a",class_name:"row_indexation_findspots",href:`findspot/${t.section_id}`,text_content:"- "+t.name+" "+a,parent:n}),n}};