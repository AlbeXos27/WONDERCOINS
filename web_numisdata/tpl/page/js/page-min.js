"use strict";var page={trigger_url:page_globals.__WEB_ROOT_WEB__+"/web/trigger.web.php",default_image:page_globals.__WEB_ROOT_WEB__+"/tpl/assets/images/default.jpg",image_galleries:[],maps_config:{source_maps:[{name:"DARE",url:"https://dh.gu.se/tiles/imperium/{z}/{x}/{y}.png",options:{maxZoom:11},default:!0},{name:"OSM",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19}},{name:"Map Tiles",url:"https://api.maptiler.com/maps/basic/256/{z}/{x}/{y}@2x.png?key=udlBrEEE2SPm1In5dCNb",options:{maxZoom:20},default:!1},{name:"ARCGIS",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}},{name:"AWMC",url:"http://cawm.lib.uiowa.edu/tiles/{z}/{x}/{y}.png",options:{}}],popup_options:{maxWidth:420,closeButton:!1,className:"map_popup"},markers:{mint:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/purple.png?3",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[30,30],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20],path:{weight:3,opacity:1,color:"#fe1500",lineJoin:"bevel",fill:!1,fillColor:"#fe1500",fillOpacity:.7,dashArray:"5"}},findspot:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/orange.png?3",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[30,30],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20],path:{weight:3,opacity:1,color:"#fdb314",lineJoin:"bevel",fill:!1,fillColor:"#fdb314",fillOpacity:.7,dashArray:"5"}},hoard:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/green.png?3",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[30,30],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20],path:{weight:3,opacity:1,color:"#fdb314",lineJoin:"bevel",fill:!1,fillColor:"#fdb314",fillOpacity:.7,dashArray:"5"}}}},setup:function(){const self=this;this.hilite_lang(page_globals.WEB_CURRENT_LANG_CODE);const footer=document.getElementById("footer");let showing_debug;return footer&&setTimeout((function(){footer.classList.remove("hidded")}),500),document.addEventListener("keydown",(function(e){if(!0===e.ctrlKey&&"d"===e.key){const all_debug_info=document.querySelectorAll(".debug_info");if(all_debug_info)if(!0===showing_debug){for(let i=all_debug_info.length-1;i>=0;i--)all_debug_info[i].classList.add("hide");showing_debug=!1}else{for(let i=all_debug_info.length-1;i>=0;i--)all_debug_info[i].classList.remove("hide");showing_debug=!0}}})),!0},hilite_lang:function(lang){const page_lang_selector=document.getElementById("page_lang_selector");if(page_lang_selector){const nodes=page_lang_selector.querySelectorAll("a");for(let i=0;i<nodes.length;i++)-1!==nodes[i].href.indexOf(lang)&&nodes[i].classList.add("selected");const lang_globe=document.getElementById("lang_globe");lang_globe.addEventListener("click",(function(){page_lang_selector.classList.toggle("hide")}))}return!0},load_more_items:function(button_obj){var template_map=JSON.parse(button_obj.dataset.template_map),target_div=document.getElementById(button_obj.dataset.target),spinner=document.createElement("div");spinner.classList.add("spinner_list"),target_div.appendChild(spinner);var trigger_vars={mode:"load_more_items",template_map:template_map};const js_promise=common.get_json_data(this.trigger_url,trigger_vars,!0).then((function(response){if(null===response)console.warn("[page.load_more_items] Error. Null response");else{var list_rows=document.createElement("div");list_rows.innerHTML=response.html;for(var ar_childrens=list_rows.children;ar_childrens.length>0;)target_div.appendChild(ar_childrens[0]);template_map.offset=template_map.offset+template_map.max_records,button_obj.dataset.template_map=JSON.stringify(template_map),template_map.offset>=template_map.total_records&&(button_obj.style.display="none")}spinner.remove()}));return js_promise},adjust_image_size:function(image_obj){image_obj.style.opacity=0;var actual_image=document.createElement("img");return actual_image.src=image_obj.style.backgroundImage.replace(/"/g,"").replace(/url\(|\)$/gi,""),actual_image.addEventListener("load",(function(){var width=this.width,height;this.height>width&&image_obj.classList.add("vertical"),image_obj.style.opacity=1}),!1),!0},adjust_footer_position:function(){let scrollbar=!1;const top_container=document.getElementById("wrapper");if(!top_container)return console.log("top_container not found !"),!1;{const top_container_height=top_container.offsetHeight,window_height=window.innerHeight;top_container_height>window_height&&(scrollbar=!0)}const footer=document.getElementById("footer");return!1===scrollbar?footer.classList.add("fixed"):footer.classList.remove("fixed"),scrollbar},activate_tooltips:function(elements){SHOW_DEBUG,$(elements).each((function(){new Tooltip($(this),{placement:"top"})}))},build_paginator_html:function(page_nodes_data,container){const self=this,wrapper_ul=container;wrapper_ul.dataset.total=page_nodes_data.total;const ar_nodes=page_nodes_data.ar_nodes,ar_nodes_length=ar_nodes.length;for(let i=0;i<ar_nodes_length;i++){const node=ar_nodes[i];let label=node.label,class_name="page "+node.type+" "+node.id;!1===node.active&&(class_name+=" unactive"),"previous"!==node.id&&"next"!==node.id&&"last"!==node.id&&"first"!==node.id||(label=""),!0===node.selected&&(class_name+=" selected"),"extra"===node.type?(class_name=node.type,common.create_dom_element({element_type:"span",class_name:class_name,text_content:label,parent:wrapper_ul})):(common.create_dom_element({element_type:"a",class_name:class_name,text_content:label,dataset:{offset:node.offset_value,active:node.active},parent:wrapper_ul}),node.active)}return wrapper_ul.addEventListener("click",this.paginator_click_event),wrapper_ul},paginator_click_event:function(e){const self=this,element=e.target,active=element.dataset.active;if("true"!==active)return!1;const total=parseInt(element.parentNode.dataset.total),offset=element.dataset.offset,search_form=document.getElementById("search_form"),js_promise=main_home.search(search_form,null,offset,total);return js_promise.then((function(response){const catalogo_rows_list=self.result_container})),js_promise},add_spinner:function(target){if(target){const image=common.create_dom_element({element_type:"img",class_name:"spinner_svg",src:page_globals.__WEB_ROOT_WEB__+"/tpl/assets/images/spinner.svg"});target.appendChild(image)}else console.warn("[add_spinner] Error on get target ",target);return!0},remove_spinner:function(target){const spinner=target.querySelector(".spinner_svg");return!!spinner&&(spinner.remove(),!0)},remote_image:function(url){if(url){let remote_url="";return remote_url=-1!==url.indexOf("v5/media_test")?url.replace(/\/v5\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"):url.replace(/\/dedalo\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"),remote_url}return null},parse_legend_svg:function(value){return-1!==value.indexOf("http")?value:value.replace(/\/dedalo\/media\/svg\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/svg/")},remove_gaps:function(value,separator){const beats=value.split(separator).filter(Boolean),result=beats.join(separator);return result},split_data:function(value,separator){const result=value?value.split(separator):[];return result},is_empty:function(value){return value&&value.length>0},trim_char:function(string,charToRemove){if(!string)return string;for(;string.charAt(0)==charToRemove;)string=string.substring(1);for(;string.charAt(string.length-1)==charToRemove;)string=string.substring(0,string.length-1);return string},parse_date:function(timestamp){if(!timestamp||timestamp.length<4)return null;const year=timestamp.substring(0,4),month=timestamp.substring(5,7),day=timestamp.substring(8,10),ar_parts=[];day&&"00"!=day&&ar_parts.push(day),month&&"00"!=month&&ar_parts.push(month),year&&"00"!=year&&ar_parts.push(year);const date=ar_parts.join("-");return date},activate_images_gallery:function(images_gallery_container,clean){const self=this;if(!0===clean&&self.image_galleries.length>0){const currentGalleriesLength=self.image_galleries.length;for(let i=0;i<currentGalleriesLength;i++)self.image_galleries[i].removeGallery(),self.image_galleries.splice(i,1)}const newGallery=Object.create(image_gallery);newGallery.set_up({galleryNode:images_gallery_container}),self.image_galleries.push(newGallery)},map_popup_builder:function(item){const popup_wrapper=common.create_dom_element({element_type:"div",class_name:"popup_wrapper"}),group=item.group,collator=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0});group.sort((a,b)=>collator.compare(a.title,b.title));const build_pop_item=function(group_data){const section_id=group_data.section_id,title=group_data.title||"Undefined title "+section_id,description=group_data.description,popup_item=common.create_dom_element({element_type:"div",class_name:"popup_item",parent:popup_wrapper});common.create_dom_element({element_type:"div",class_name:"text_title",inner_html:title,parent:popup_item}),description&&description.length>0&&common.create_dom_element({element_type:"div",class_name:"text_description",inner_html:description,parent:popup_item})},group_length=group.length;let limit=100;function iterate(from,to){for(let i=from;i<to;i++)build_pop_item(group[i]);if(to<group_length-1){const more_node=common.create_dom_element({element_type:"input",type:"button",value:tstring.load_more||"Load more..",class_name:"more_node btn btn-light btn-block primary",parent:popup_wrapper});more_node.addEventListener("click",(function(){const _from=this.offset+1,_to=_from+100<group_length?_from+100:group_length;iterate(_from,_to),this.remove()})),more_node.offset=to}}const to=100<group_length?100:group_length;return iterate(0,to),popup_wrapper},load_hires:function load_hires(){this.removeEventListener("load",load_hires,!1);const image=this,hires=this.hires;setTimeout((function(){image.src=hires}),100)},sort_array_by_property:function(array,property){const ar_ordered=array.sort((function(a,b){return a[property].localeCompare(b[property])}));return ar_ordered},filter_drop_down_list:function(array,filter_string){return array.filter((function(el){const el_normalized=el.value.normalize("NFD").replace(/[\u0300-\u036f]/g,""),filtered=el.value.toLowerCase().indexOf(filter_string.toLowerCase())>-1||el_normalized.toLowerCase().indexOf(filter_string.toLowerCase())>-1;return filtered}))},create_expandable_block:function(textBlock,nodeParent){textBlock.classList.add("contracted-block");const textBlockSeparator=common.create_dom_element({element_type:"div",class_name:"text-block-separator",parent:nodeParent}),separatorArrow=common.create_dom_element({element_type:"div",class_name:"separator-arrow",parent:textBlockSeparator});return textBlockSeparator.addEventListener("click",(function(){textBlock.classList.contains("contracted-block")?(textBlock.classList.remove("contracted-block"),separatorArrow.style.transform="rotate(-90deg)"):(textBlock.classList.add("contracted-block"),separatorArrow.style.transform="rotate(90deg)")})),!0},load_main_catalog:function(){const body={dedalo_get:"records",db_name:page_globals.WEB_DB,table:"main_catalogs",lang:page_globals.WEB_CURRENT_LANG_CODE,sql_filter:"catalog_name='"+page_globals.OWN_CATALOG_ACRONYM+"'",limit:1,resolve_portals_custom:{publication_data:"publications"},count:!1},js_promise=data_manager.request({body:body});return js_promise}};