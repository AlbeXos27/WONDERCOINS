"use strict";page.render_map_legend=function(){const map_legend=common.create_dom_element({element_type:"div",class_name:"map_legend"});return common.create_dom_element({element_type:"div",class_name:"legend_item",inner_html:tstring.mint+'<img src="'+page.maps_config.markers.mint.iconUrl+'"/>',parent:map_legend}),common.create_dom_element({element_type:"div",class_name:"legend_item",inner_html:tstring.hoard+'<img src="'+page.maps_config.markers.hoard.iconUrl+'"/>',parent:map_legend}),common.create_dom_element({element_type:"div",class_name:"legend_item",inner_html:tstring.findspot+'<img src="'+page.maps_config.markers.findspot.iconUrl+'"/>',parent:map_legend}),map_legend},page.render_export_data_buttons=function(){let request_body,result,export_data_parser,filter,uri;function get_data(){const data_object={info:"WARNING! This is a draft version data. Please do not use it in production",source_org:"Numisdata",source_url:page_globals.__WEB_BASE_URL__,lang:page_globals.WEB_CURRENT_LANG_CODE,date:common.get_today_date()};return new Promise((function(resolve){if(!request_body)return result?void setTimeout((function(){resolve(result)}),1e3):(console.warn("Invalid result or request_body:",request_body),void resolve(!1));request_body.limit=0,request_body.resolve_portals_custom=null,data_manager.request({body:request_body}).then((function(api_response){resolve(api_response.result)}))})).then((function(rows){let rows_catalog;return console.log("----\x3e render_export_data_buttons rows:",rows),Array.isArray(rows)&&(rows=rows.filter(r=>"types"==r.term_table)),data_object.data=export_data_parser&&"function"==typeof export_data_parser?export_data_parser(rows):rows,data_object}))}function manage_data_request_done(options){request_body=options.request_body,result=options.result,export_data_parser=options.export_data_parser||null,filter=options.filter}event_manager.subscribe("data_request_done",manage_data_request_done);const fragment=new DocumentFragment;if("catalog"===WEB_AREA){const button_share_search_container=common.create_dom_element({element_type:"div",class_name:"export_container",parent:fragment}),button_share_search=common.create_dom_element({element_type:"input",type:"button",value:tstring.share_search||"Share search",class_name:"btn primary button_download share_search",parent:button_share_search_container});button_share_search.addEventListener("click",(function(){const button=this,min_psqo=psqo_factory.build_safe_psqo(filter),shared_wrapper=common.create_dom_element({element_type:"div",class_name:"shared_wrapper",parent:document.body});shared_wrapper.addEventListener("click",(function(e){shared_wrapper.remove()}));const shared_container=common.create_dom_element({element_type:"div",class_name:"shared_container",parent:shared_wrapper});shared_container.addEventListener("click",(function(e){e.stopPropagation()}));const shared_json=common.create_dom_element({element_type:"div",class_name:"shared_json",text_content:JSON.stringify(min_psqo,null,2),parent:shared_container}),encoded_psqo=psqo_factory.encode_psqo(min_psqo);uri=window.location.protocol+"//"+window.location.host+page_globals.__WEB_ROOT_WEB__+"/"+WEB_AREA+"/?psqo="+encoded_psqo;const shared_uri_encoded=common.create_dom_element({element_type:"div",class_name:"shared_uri_encoded",parent:shared_container}),uri_node=common.create_dom_element({element_type:"span",text_content:uri,title:uri.length,parent:shared_uri_encoded}),link=common.create_dom_element({element_type:"a",href:uri,inner_html:tstring.search||"Search",target:"_blank",parent:shared_uri_encoded})}))}const button_export_json_container=common.create_dom_element({element_type:"div",class_name:"export_container",parent:fragment}),button_export_json=common.create_dom_element({element_type:"input",type:"button",value:tstring.export_json||"Export JSON",class_name:"btn primary button_download json",parent:button_export_json_container});button_export_json.addEventListener("click",(function(){const button=this;button.classList.add("unactive");const spinner=common.create_dom_element({element_type:"div",class_name:"spinner small",parent:button_export_json_container});get_data().then((function(data){const file_name="mib_export_data.json",blob_data=new Blob([JSON.stringify(data,null,2)],{type:"application/json",name:file_name}),href=URL.createObjectURL(blob_data),link_obj=common.create_dom_element({element_type:"a",href:href,download:file_name});link_obj.click(),link_obj.remove(),spinner.remove(),button.classList.remove("unactive")}))}));const button_export_csv_container=common.create_dom_element({element_type:"div",class_name:"export_container",parent:fragment}),button_export_csv=common.create_dom_element({element_type:"input",type:"button",value:tstring.export_csv||"Export CSV",class_name:"btn primary button_download csv",parent:button_export_csv_container});return button_export_csv.addEventListener("click",(function(){const button=this;button.classList.add("unactive");const spinner=common.create_dom_element({element_type:"div",class_name:"spinner small",parent:button_export_csv_container});get_data().then((function(data){const file_name="mib_export_data.csv",csv=page.convert_json_to_csv(data.data),blob_data=new Blob([csv],{type:"text/csv",name:file_name}),href=URL.createObjectURL(blob_data),link_obj=common.create_dom_element({element_type:"a",href:href,download:file_name});link_obj.click(),link_obj.remove(),spinner.remove(),button.classList.remove("unactive")}))})),fragment},page.create_suggestions_button=function(){let currentUrl="";const fragment=new DocumentFragment,button_form_container=common.create_dom_element({element_type:"div",class_name:"form_button_container",parent:fragment});function manage_data_request_done(options){const filter=options.filter;if(null!=filter){const min_psqo=psqo_factory.build_safe_psqo(filter),encoded_psqo=psqo_factory.encode_psqo(min_psqo);currentUrl=window.location.protocol+"//"+window.location.host+page_globals.__WEB_ROOT_WEB__+"/"+WEB_AREA+"/?psqo="+encoded_psqo}}common.create_dom_element({element_type:"input",type:"button",value:tstring.suggest_error||"Suggestions / errors",class_name:"btn primary button_contact",parent:button_form_container}),event_manager.subscribe("data_request_done",manage_data_request_done);const form=createForm();function createForm(){const formTitle_label=tstring.contact_form||"Contact form",submitButton_Label=tstring.submit||"Submit",cancelButton_Label=tstring.cancel||"Cancel",name_Label=(tstring.name||"Name")+":",email_Label=(tstring.email||"Email")+":",message_Label=(tstring.message||"Message")+":",popUpContainer=common.create_dom_element({element_type:"div",id:"popup-container"}),form_container=common.create_dom_element({element_type:"div",class_name:"form_container",parent:popUpContainer});common.create_dom_element({element_type:"h2",class_name:"form-title",text_content:formTitle_label,parent:form_container}),common.create_dom_element({element_type:"h3",class_name:"form-title",text_content:tstring.suggest_error||"Suggestions / errors",parent:form_container});const formAction=' onsubmit ="page.sendForm()" ';let form=document.createRange().createContextualFragment('<form id="contact-form"></form>');const fname=document.createRange().createContextualFragment('<label for="fname">'+name_Label+'</label><input type="text" id="fname" name="fname" value="" required>'),fmail=document.createRange().createContextualFragment('<label for="fmail">'+email_Label+'</label><input type="email" id="fmail" name="fmail" value="" required>'),fmessage=document.createRange().createContextualFragment('<label for="fmessage">'+message_Label+'</label><textarea id="fmessage" name="message" required></textarea>'),form_button=document.createRange().createContextualFragment('<input class="send-button" type="submit" value="'+submitButton_Label+'">'),cancel_button=document.createRange().createContextualFragment('<input class="cancel-button" type="button" value="'+cancelButton_Label+'">'),error_msn=document.createRange().createContextualFragment('<p id="error-msn"></p>');return form.firstElementChild.addEventListener("submit",(function(event){event.preventDefault(),page.handleForm(currentUrl)})),form.firstElementChild.appendChild(fname),form.firstElementChild.appendChild(fmail),form.firstElementChild.appendChild(fmessage),form.firstElementChild.appendChild(error_msn),form.firstElementChild.appendChild(form_button),form.firstElementChild.appendChild(cancel_button),form_container.appendChild(form),popUpContainer}return button_form_container.addEventListener("click",(function(){document.querySelector("body").appendChild(form),document.querySelector(".cancel-button").addEventListener("click",page.removeForm)})),fragment},page.removeForm=function(){document.querySelector(".cancel-button").removeEventListener("click",page.removeForm),document.querySelector("#popup-container").remove()},page.handleForm=function(currentUrl){document.querySelector("#error-msn").textContent="";const currentForm=document.querySelector("#contact-form"),today=(new Date).toUTCString(),name=currentForm.querySelector("#fname").value,email=currentForm.querySelector("#fmail").value,message=currentForm.querySelector("#fmessage").value;let url=window.location.href;null!=currentUrl&&currentUrl.length>0&&(url=currentUrl);const body={mail:{subject:`${name} '${email}' NUMISDATA [${today}]`,message:message},data:{name:name,email:email,message:message,lang:page_globals.WEB_CURRENT_LANG_CODE,web_url:url,date:today}};return new Promise((function(resolve){const success_msn="Mensaje enviado correctamente, gracias.",error_msn="Ha ocurrido un error. Por favor, prueba mÃ¡s tarde.";data_manager.request({url:__WEB_TEMPLATE_WEB__+"/assets/lib/sendmail/send.php",body:body}).then(api_response=>{console.log("--- sendmail api_response:",api_response),api_response.result?(alert(success_msn),currentForm.reset(),page.removeForm()):document.querySelector("#error-msn").textContent=error_msn})}))},page.render_legend=function(options){const self=this,value=options.value||"",style=options.style||"median",legend_node=common.create_dom_element({element_type:"div",class_name:"legend_box "+style,inner_html:value.trim()});return legend_node},page.render_type_label=function(row){let current_value;const mint_number=row.ref_mint_number?row.ref_mint_number+"/":"";if(row.term_section_id&&!row.children){const ar=row.term.split(", "),c_name=ar[0],keyword=void 0===ar[1]?"":function(){const clean=[];for(let i=1;i<ar.length;i++)clean.push(ar[i]);return'<span class="keyword">, '+clean.join(", ").trim()+"</span>"}(),section_id=row.term_section_id&&row.term_section_id.section_id?row.term_section_id.section_id:row.term_section_id,a_term=common.create_dom_element({element_type:"a",class_name:"a_term",href:page_globals.__WEB_ROOT_WEB__+"/type/"+section_id,target:"_blank",title:mint_number+c_name+ar.join(", ").trim(),inner_html:mint_number+c_name+keyword});current_value=a_term.outerHTML}else current_value=page_globals.OWN_CATALOG_ACRONYM+" "+mint_number+row.term;return current_value},page.render_weight_value=function(row){const weight=row.ref_type_averages_weight.toFixed(2).replace(/\.?0+$/,"");return weight.replace(".",",")+" g"},page.render_diameter_value=function(row){const diameter=row.ref_type_averages_diameter.toFixed(2).replace(/\.?0+$/,"");return diameter.replace(".",",")+" mm"};