"use strict";var render_hoard={caller:null,draw_treasure:async function(options){const row=options.row;if(console.log("draw_hoard options:",row),!row)return console.warn("Warning! draw_row row no found in options"),fragment;const fragment=new DocumentFragment,coins=await this.cargarMonedasComplejos(row.coins),types=await this.cargarTiposComplejos(row.types);console.log("Tipos del complejo:",types);const line=common.create_dom_element({element_type:"div",parent:fragment});if(!0===dedalo_logged){const link=common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",text_content:row.section_id,href:"/dedalo/lib/dedalo/main/?t=numisdata5&id="+row.section_id,parent:line});link.setAttribute("target","_blank")}if(row.name&&row.name.length>0){const lineTittleWrap=common.create_dom_element({element_type:"div",class_name:"line-tittle-wrap",parent:line});if(common.create_dom_element({element_type:"div",class_name:"line-tittle golden-color",text_content:row.name,parent:lineTittleWrap}),row.place&&row.place.length>0){const place="| "+row.place;common.create_dom_element({element_type:"div",class_name:"info_value",text_content:place,parent:lineTittleWrap})}}if(row.coins&&row.coins.length>0){const n_coins=row.coins.length;common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:(tstring.total_coins||"Total coins")+": "+n_coins,parent:fragment})}if(row.public_info&&common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:row.public_info,parent:fragment}),row.bibliography_data&&row.bibliography_data.length>0){const lineSeparator=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:fragment});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:tstring.bibliographic_references||"Bibliographic references",parent:lineSeparator});const bibliography_block=common.create_dom_element({element_type:"div",class_name:"info_text_block",parent:fragment}),ref_biblio=row.bibliography_data,ref_biblio_length=ref_biblio.length;for(let i=0;i<ref_biblio_length;i++){const biblio_row_node=biblio_row_fields.render_row_bibliography(ref_biblio[i]),biblio_row_wrapper=common.create_dom_element({element_type:"div",class_name:"bibliographic_reference",parent:bibliography_block});biblio_row_wrapper.appendChild(biblio_row_node)}page.create_expandable_block(bibliography_block,fragment)}row.link&&common.create_dom_element({element_type:"a",class_name:"icon_link info_value",inner_html:row.link,href:row.link,target:"_blank",parent:fragment});const map_container=common.create_dom_element({element_type:"div",class_name:"map_container",parent:fragment}),map_fact=new map_factory;let resultado={hallazgos:{datos:[]},cecas:{datos:[]},complejos:{datos:[]}};resultado.complejos.datos.push(row);const map=map_fact.init({map_container:map_container,map_position:row.map,source_maps:page.maps_config.source_maps,result:resultado,findspot:!0,unique:!0}),title_coin=common.create_dom_element({element_type:"h2",class_name:"title_info",text_content:"Monedas Halladas",parent:fragment});common.create_dom_element({element_type:"div",class_name:"golden-separator",parent:title_coin});const coinsContainer=common.create_dom_element({element_type:"div",class_name:"coins_container",parent:fragment});for(let index=0;index<coins.result.length;index++){const infoContainer=common.create_dom_element({element_type:"div",class_name:"info_container",parent:coinsContainer}),title_container=common.create_dom_element({element_type:"div",class_name:"title-container",parent:infoContainer}),typeValue=coins&&coins.result&&coins.result[index]&&coins.result[index].type_full_value,parts=typeValue?typeValue.split("|"):[],lastPart=(parts&&parts.length>0?parts[parts.length-1]:"").trim(),type_full_val=coins.result[index].denomination?coins.result[index].denomination+" | "+lastPart.replace(coins.result[index].denomination,"").trim():coins.result[index].type_full_value,type_none=type_full_val||"Tipo";let value,coin_type=coins.result[index].type_data?coins.result[index].type_data.replace('"',"").replace("[","").replace("]","").replace('"',""):0;common.create_dom_element({element_type:"a",class_name:"type_link",href:`/web_numisdata/type/${coin_type}`,text_content:type_none,parent:title_container});const imgContainer=common.create_dom_element({element_type:"div",class_name:"img-container",parent:infoContainer}),image_obverse="https://wondercoins.uca.es"+coins.result[index].image_obverse,image_reverse="https://wondercoins.uca.es"+coins.result[index].image_reverse;common.create_dom_element({element_type:"img",class_name:"img_obverse",parent:imgContainer,src:image_obverse}),common.create_dom_element({element_type:"img",class_name:"img_obverse",parent:imgContainer,src:image_reverse}),common.create_dom_element({element_type:"div",class_name:"collection-container",text_content:coins.result[index].collection,parent:infoContainer});const weight=coins.result[index].weight?coins.result[index].weight+" g; ":" ",diameter=coins.result[index].diameter?coins.result[index].diameter+" mm; ":" ",dies=coins.result[index].dies?coins.result[index].dies+" h":" ";common.create_dom_element({element_type:"div",class_name:"data-container",text_content:weight+diameter+dies,parent:infoContainer}),common.create_dom_element({element_type:"div",class_name:"public-info",text_content:coins.result[index].bibliography_title,parent:infoContainer});const link=common.create_dom_element({element_type:"a",class_name:"coin_link",href:`/web_numisdata/coin/${coins.result[index].section_id}`,parent:infoContainer}),img=common.create_dom_element({element_type:"img",class_name:"coin_icon",src:"/web_numisdata/tpl/assets/images/icon_link_color.svg",parent:link}),span=common.create_dom_element({element_type:"span",text_content:"MIB",parent:link})}return fragment},cargarMonedasComplejos:async function(ids){try{const filtro=Array.isArray(ids)?`section_id IN (${ids.join(",")})`:`section_id = ${ids}`,monedas=await data_manager.request({body:{dedalo_get:"records",table:"coins",ar_fields:["*"],sql_filter:filtro,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}});return monedas}catch(error){console.error("Error cargando datos:",error)}},cargarTiposComplejos:async function(ids){try{const filtro=Array.isArray(ids)?`section_id IN (${ids.join(",")})`:`section_id = ${ids}`,monedas=await data_manager.request({body:{dedalo_get:"records",table:"types",ar_fields:["*"],sql_filter:filtro,limit:0,count:!0,offset:0,order:"section_id ASC",process_result:null}});return monedas}catch(error){console.error("Error cargando datos:",error)}}};