"use strict";var type={search_options:{},map:null,export_data_container:null,section_id:null,set_up:function(options){const self=this;self.export_data_container=options.export_data_container,self.section_id=options.section_id;const export_data_buttons=page.render_export_data_buttons();self.export_data_container.appendChild(export_data_buttons),self.export_data_container.classList.add("hide");const contact_form_button=page.create_suggestions_button();return self.export_data_container.appendChild(contact_form_button),void 0!==self.section_id&&self.get_row_data({section_id:self.section_id}).then((function(response){console.log("[set_up->get_row_data] response:",response);const container=document.getElementById("row_detail");for(;container.hasChildNodes();)container.removeChild(container.lastChild);const type=response.result.find(item=>"type"===item.id),catalog=response.result.find(item=>"catalog"===item.id);if(console.log(type),void 0!==type.result[0]){const row=type.result[0],catalog_rows=page.parse_catalog_data(catalog.result)[0]||null;row.catalog=catalog_rows,page.parse_type_data(row),console.log("Lista rows ",row),event_manager.publish("data_request_done",{request_body:null,result:row,export_data_parser:page.export_parse_type_data});const ar_fields=["*"],count=!0,order="name",resolve_portals_custom={bibliography_data:"bibliographic_references"},section_id_row=row.mint_data[0].section_id;data_manager.request({body:{dedalo_get:"records",table:"mints",ar_fields:["*"],sql_filter:"section_id = "+parseInt(section_id_row),limit:0,count:count,offset:0,order:order,process_result:null,resolve_portals_custom:resolve_portals_custom}}).then((async function(api_response){const datos_ceca=api_response.result[0],map_fact=new map_factory;let resultado={hallazgos:{datos:[]},cecas:{datos:[]},complejos:{datos:[]}};const map_pars=datos_ceca.map?JSON.parse(datos_ceca.map):null;resultado.cecas.datos.push(row.mint_data[0]),data_manager.request({body:{dedalo_get:"records",table:"findspots",ar_fields:["*"],sql_filter:`types LIKE "%${self.section_id}%"`,limit:0,count:count,offset:0,order:order,process_result:null}}).then((async function(api_response){let hallazgos=new Array;for(let index=0;index<api_response.result.length;index++){const typesArray=JSON.parse(api_response.result[index].types),result=typesArray.filter(num=>num===`${self.section_id}`);result.length>0&&hallazgos.push(api_response.result[index])}resultado.hallazgos.datos=hallazgos;const map=map_fact.init({map_container:map_container,map_position:map_pars,source_maps:page.maps_config.source_maps,result:resultado,unique:!0,zoom:5})}))})),self.list_row_builder(row).then((function(row_wrapper){container.appendChild(row_wrapper);const embeddedGallery=row_wrapper.querySelectorAll("a");if(embeddedGallery&&embeddedGallery.length>0){row_wrapper.querySelector(".identify_coin_wrapper").remove();const newGallery=Object.create(image_gallery);newGallery.set_up_embedded({galleryNode:embeddedGallery,galleryPrimId:"embedded-gallery-id",containerId:"embedded-gallery",result:response})}const images_gallery_containers=row_wrapper.querySelectorAll(".gallery");if(images_gallery_containers)for(let i=0;i<images_gallery_containers.length;i++)page.activate_images_gallery(images_gallery_containers[i]);self.export_data_container.classList.remove("hide")}))}})),!0},get_row_data:function(options){const section_id=options.section_id,lang=options.lang||page_globals.WEB_CURRENT_LANG_CODE,ar_calls=[];ar_calls.push({id:"type",options:{dedalo_get:"records",table:"types",ar_fields:["*"],lang:lang,sql_filter:"section_id = "+parseInt(section_id),count:!1,resolve_portals_custom:{bibliography_data:"bibliographic_references",ref_coins_union:"coins",coin_references:"coins","coins.bibliography_data":"bibliographic_references",ref_coins_findspots_data:"findspots","findspots.bibliography_data":"bibliographic_references",ref_coins_hoard_data:"hoards","hoards.bibliography_data":"bibliographic_references",denomination_data:"denomination",material_data:"material",related_types_data:"types",mint_data:"mints"}}});const ar_fields=["section_id","term","term_data","term_table","term_section_tipo","parents","ref_mint_number","full_coins_reference_calculable","full_coins_reference_diameter_max","full_coins_reference_weight","full_coins_reference_axis"];ar_calls.push({id:"catalog",options:{dedalo_get:"records",table:"catalog",ar_fields:ar_fields,lang:lang,count:!1,sql_filter:"term_data='[\""+parseInt(section_id)+"\"]' AND term_table='types'",resolve_portals_custom:{parents:"catalog"}}});const js_promise=data_manager.request({body:{dedalo_get:"combi",ar_calls:ar_calls}});return js_promise},list_row_builder:function(row){const self=this;return new Promise((function(resolve){self.parse_publication(row.bibliography_data);const coins_length=row.ref_coins_union.length;for(let i=0;i<coins_length;i++){const item=row.ref_coins_union[i];self.parse_publication(item.bibliography_data)}const findspots_length=row.ref_coins_findspots_data.length;for(let i=0;i<findspots_length;i++){const item=row.ref_coins_findspots_data[i];self.parse_publication(item.bibliography_data)}const hoards_length=row.ref_coins_hoard_data.length;for(let i=0;i<hoards_length;i++){const item=row.ref_coins_hoard_data[i];self.parse_publication(item.bibliography_data)}self.parse_ordered_coins(row),type_row_fields_min.type_row_fields.caller=self;const row_node=type_row_fields_min.type_row_fields.draw_item(row);resolve(row_node)}))},parse_publication:function(data){return page.parse_publication(data)},parse_ordered_coins:function(row){const parsed_data=[],separator=" | ",typology_data=page.split_data(row.ref_coins_typology_data," | "),typology_data_length=typology_data.length,typology=page.split_data(row.ref_coins_typology," | "),ref_coins=page.split_data(row.ref_coins," | ");for(let i=0;i<typology_data_length;i++){const typology_id=typology_data[i]?JSON.parse(typology_data[i])[0]:null,current_coins=ref_coins[i]?JSON.parse(ref_coins[i]):[],parsed_item={typology_id:typology_id,typology:typology[i]||null,coins:current_coins};parsed_data.push(parsed_item)}return row._coins_group=parsed_data,parsed_data}};